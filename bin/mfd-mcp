#!/usr/bin/env bash
# MFD MCP server wrapper â€” keep command stable when `npx`/shebang global dependencies are missing.
set -euo pipefail

SOURCE="$0"
while [ -L "$SOURCE" ]; do
  DIR="$(cd "$(dirname "$SOURCE")" && pwd)"
  SOURCE="$(readlink "$SOURCE")"
  [[ "$SOURCE" != /* ]] && SOURCE="$DIR/$SOURCE"
done
SCRIPT_DIR="$(cd "$(dirname "$SOURCE")" && pwd)"
PLUGIN_DIR="$(cd "$SCRIPT_DIR/.." && pwd)"

if [ ! -d "$PLUGIN_DIR/node_modules" ]; then
  npm install --omit=dev --prefix "$PLUGIN_DIR" --silent 2>/dev/null || true
fi

exec node "$PLUGIN_DIR/dist/mcp/server.js" "$@"

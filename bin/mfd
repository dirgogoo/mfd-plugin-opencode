#!/usr/bin/env bash
# MFD CLI wrapper â€” resolves to the compiled dist inside the plugin
# Resolve symlinks to find the real script location
SOURCE="$0"
while [ -L "$SOURCE" ]; do
  DIR="$(cd "$(dirname "$SOURCE")" && pwd)"
  SOURCE="$(readlink "$SOURCE")"
  # Handle relative symlinks
  [[ "$SOURCE" != /* ]] && SOURCE="$DIR/$SOURCE"
done
SCRIPT_DIR="$(cd "$(dirname "$SOURCE")" && pwd)"
PLUGIN_DIR="$(cd "$SCRIPT_DIR/.." && pwd)"

# Auto-install deps if missing
if [ ! -d "$PLUGIN_DIR/node_modules" ]; then
  echo "[MFD] Installing dependencies (first run)..." >&2
  npm install --production --prefix "$PLUGIN_DIR" --silent 2>/dev/null
fi

exec node "$PLUGIN_DIR/dist/core/cli/index.js" "$@"
